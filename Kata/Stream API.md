---
tags:
  - kata
  - java
  - core
  - functional
---
## Что такое Stream API? Для чего нужны стримы?
Инструмент языка Java, который позволяет использовать функциональный стиль при работе с разными структурами данных.
Интерфейс `java.util.Stream` представляет собой последовательность элементов, над которой можно производить различные операции. Последовательность потенциально бесконечная, с возможность применять к ней, сложные, поэтапные преобразования без цикла и условного оператора.

Операции над стримами бывают
- промежуточными
- терминальными.
#### Терминальные
операции возвращают результат определенного типа
#### Промежуточные операции
возвращают стрим. Таким образом вы можете строить цепочки из нескольких (промежуточных) операций над одним и тем же стримом.

Stream не может быть использованы повторно. Как только была вызвана терминальная операция, stream закрывается.

Стримы бывают:
- конечные и бесконечные
- последовательные и параллельные (создаются специальной командой)
- объектные и примитивные (специальные типы стримов для примитивных типов)
##  Почему Stream называют ленивым?
Ленивая инициализация - приём в разработке, когда ресурсоемкая операция выполняется только тогда, когда нужен ее результат. Для оптимизации производительности.
Stream API так и работает: мы указываем промежуточные операции, которые нам необходимо произвести и в конце следует завершающая или терминальная операция, которая **запускает** все вычисления.
## Какие существуют способы создания стрима?
- Стрим из коллекции: `list.stream();`
- Стрим из Map: `map.entrySet().stream();`
- Стрим из массива: `Arrays.stream(array);`
- из `String.chars()`, будет `IntStream` с символами
- из `BufferedReader.lines()`

- Пустой стрим: `Stream.empty();`
- Стрим из указанных элементов: `Stream.of("1", "2", "3");`
- `Stream.iterate(...)`
- `Stream.generate(...)`

## Как из коллекции создать стрим?
```java
Collection<String> collection = Arrays.asList("a1", "a2", "a3");
Stream<String> streamFromCollection = collection.stream();
```
## Какие промежуточные методы в стримах вы знаете?
- filter(Predicate) - отфильтровывает записи, возвращая только записи, соответствующие условию;
- map() - преобразует каждый элемент;
- flatMap() - похожи на map(), но могут создавать из одного элемента несколько;
- mapToInt(), mapToDouble(), mapToLong() - аналоги map() возвращающие стрим числовых примитивов;
- mapToObj() - преобразует числовой стрим обратно в объектный
- limit(n) - позволяет ограничить выборку определенным количеством первых элементов;
- skip(n) - позволяет пропустить определённое количество элементов в начале;
- concat(Stream s1, Stream s2) - объединяет Stream в один;
- peek(someFunction) - возвращает тот же стрим, применяя к каждому элементу функцию;
- distinct() - возвращает стрим без дубликатов (для метода equals());
- sorted() - позволяет сортировать значения либо в натуральном порядке, либо задавая Comparator
## Какие терминальные методы в стримах вы знаете?
- forEach() – принимает consumer, которому будут выведены элементы стрима; forEach() - применяет функцию к каждому объекту стрима, порядок при параллельном выполнении не гарантируется;
- forEachOrdered() – как и forEach, но гарантирует порядок;   
- count() - подсчет всех значений;
- max() - возвращает максимальный элемент;
- min() - возвращает минимальный элемент;
- findAny() - находится вхождение – сразу возвращает результат;
- anyMatch() - проверяет на наличие совпадения(хоть кто-то совпал);
- allMatch() - возвращает boolean(совпадают все);
- noneMatch() - возвращает boolean(не совпадают все);
- findFirst() - возвращает первый элемент из стрима, возвращается OptionalInt;
- collect() - собирает элементы в новое хранилище;
- reduce() - результат применения бинарного оператора к каждой паре элементов стрима, пока не останется один элемент(свертка в одно значение);
- toArray() - возвращает массив
Для числовых стримов:
- sum() - возвращает сумму всех чисел;
- average() - возвращает среднее арифметическое всех чисел.

Все оконечные методы возвращают Optional - оболочка ответа (этот специальный тип ввели чтобы не возвращать null).
Терминальный метод можно вызвать только один раз;
## Расскажите про метод collect()
Stream.collect() является одним из терминальных методов.

Это позволяет выполнять изменяемые операции свертывания(переупаковка элементов в некоторые структуры данных и применение некоторой дополнительной логики, объединение их и т. д.)

Преобразует стрим в коллекцию. Принимает метод класса `Collectors`
Эта функция представляет объект Collector, который определен в пакете java.util.stream.
- toList(): преобразование к типу List;
- toSet(): преобразование к типу Set;
- toMap(): преобразование к типу Map;
- groupingBy() - разделяет коллекцию на несколько частей и возвращает `Map<N, List<T>>`;
- partitioningBy() - разделяет коллекцию на две части по соответствию условию и возвращает их как `Map<Boolean, List>`;
- summingInt(), summingDouble(), summingLong() - возвращает сумму.

## Расскажите про метод reduce()
Позволяет выполнять агрегатные функции и возвращать один результат.

Результат применения бинарного оператора к каждой паре элементов стрима, пока не останется один элемент. Позволяет выполнять агрегатные функции на всей коллекцией и возвращать один результат.
```java
collection.stream().reduce((s1, s2) -> s1 + s2).orElse(0);
```

## Расскажите о параллельной обработке в Java 8.
В Java бывают еще и параллельные стримы, обрабатывающие свои элементы одновременно в нескольких потоках.

В параллельном стриме элементы разделяются на группы. Их обработка проходит в каждом потоке по отдельности. Затем они снова объединяются, чтобы вывести результат.

Чтобы сделать обычный последовательный поток параллельным, надо вызвать у объекта Stream метод parallel(внутри потока).
А обратный метод - sequential().

Не рекомендуется применять параллельность для выполнения долгих операций.

Кроме того, можно также использовать блокирующий метод parallelStream() интерфейса Collection для создания параллельного потока из коллекции.
В то же время если рабочая машина не является многоядерной, то поток будет выполняться как последовательный.

Работает на фреймворке fork/join(под капотом).
Используют общий ForkJoinPool доступный через статический ForkJoinPool.commonPool().

При работе с параллельными стримами система сохраняет порядок следования элементов. Исключение составляет метод forEach(), который может выводить элементы в произвольном порядке. И чтобы сохранить порядок следования, необходимо применять метод forEachOrdered().

## Что такое IntStream и DoubleStream?
В Java 8 создание Stream-ов из примитивов напрямую невозможно, из-за дженериков.

Но разработчики сделали 3 Stream-а примитивов: IntStream, LongStream, DoubleStream. Работает быстрее, чем стрим с классами-обертками.

Поддерживают дополнительные терминальный методы sum(), average(), mapToObj(), count(), min(), max(), range().